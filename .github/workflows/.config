# ImmortalWrt 24.10.2 稳定编译配置
# 专门解决 x86_64 平台 GRUB 编译问题

# ===== 基本平台设置 =====
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y

# ===== 引导器配置 - 重要! =====
CONFIG_GRUB_TIMEOUT="3"
CONFIG_GRUB_TITLE="ImmortalWrt"
CONFIG_GRUB_IMAGES=y
CONFIG_GRUB_EFI_IMAGES=y

# ===== 文件系统类型 =====
CONFIG_TARGET_ROOTFS_EXT4FS=y
CONFIG_TARGET_ROOTFS_SQUASHFS=y
# CONFIG_VMDK_IMAGES=y              # VMDK 可能导致编译问题，暂时注释

# ===== 分区大小 =====
CONFIG_TARGET_KERNEL_PARTSIZE=32
CONFIG_TARGET_ROOTFS_PARTSIZE=2048

# ===== 编译优化 =====
CONFIG_CCACHE=y
CONFIG_BUILD_LOG=y
CONFIG_BUILD_LOG_DIR="./logs"
# CONFIG_DEVEL=y                     # 开发选项，可能增加编译复杂度
# CONFIG_BROKEN=y                    # 不包含破损包

# ===== 基础系统 =====
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-ssl=y

# ===== 代理工具 - 核心组件 =====
CONFIG_PACKAGE_luci-app-openclash=y
CONFIG_PACKAGE_luci-app-homeproxy=y
CONFIG_PACKAGE_luci-app-passwall=y
CONFIG_PACKAGE_luci-app-passwall2=y

# PassWall 核心依赖
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Xray=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Hysteria=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Rust_Client=y

# PassWall2 核心依赖
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_Xray=y
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_Hysteria=y
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_Shadowsocks_Rust_Client=y

# ===== Docker 支持 =====
CONFIG_PACKAGE_luci-app-dockerman=y
CONFIG_PACKAGE_luci-lib-docker=y
CONFIG_PACKAGE_docker-ce=y
CONFIG_PACKAGE_dockerd=y

# Docker 内核支持
CONFIG_DOCKER_CGROUP_OPTIONS=y
CONFIG_DOCKER_NET_MACVLAN=y
CONFIG_DOCKER_STO_EXT4=y
CONFIG_KERNEL_CGROUP_DEVICE=y
CONFIG_KERNEL_CGROUP_FREEZER=y
CONFIG_KERNEL_CGROUP_NET_PRIO=y
CONFIG_KERNEL_EXT4_FS_POSIX_ACL=y
CONFIG_KERNEL_EXT4_FS_SECURITY=y
CONFIG_KERNEL_FS_POSIX_ACL=y
CONFIG_KERNEL_NET_CLS_CGROUP=y
CONFIG_KERNEL_MEMCG_SWAP=y
CONFIG_KERNEL_MEMCG_SWAP_ENABLED=y

# ===== 网卡驱动 - 基础版本 =====
CONFIG_PACKAGE_kmod-igb=y              # Intel Gigabit
CONFIG_PACKAGE_kmod-e1000e=y           # Intel PCIe Gigabit  
CONFIG_PACKAGE_kmod-r8169=y            # Realtek Gigabit
CONFIG_PACKAGE_kmod-r8125=y            # Realtek 2.5G
CONFIG_PACKAGE_kmod-igc=y              # Intel 2.5G

# ===== USB 和存储支持 =====
CONFIG_PACKAGE_kmod-usb-core=y
CONFIG_PACKAGE_kmod-usb2=y
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_kmod-usb-storage=y

# 文件系统驱动
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-vfat=y
CONFIG_PACKAGE_kmod-fs-ntfs=y
CONFIG_PACKAGE_ntfs-3g=y

# ===== 中文界面支持 =====
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-i18n-firewall-zh-cn=y
CONFIG_PACKAGE_luci-i18n-dockerman-zh-cn=y
CONFIG_PACKAGE_luci-i18n-passwall-zh-cn=y
CONFIG_PACKAGE_luci-i18n-passwall2-zh-cn=y
CONFIG_PACKAGE_luci-i18n-openclash-zh-cn=y
CONFIG_PACKAGE_luci-i18n-homeproxy-zh-cn=y

# ===== 基础网络工具 =====
CONFIG_PACKAGE_wget-ssl=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_ca-certificates=y

# ===== 调试工具 (可选) =====
# CONFIG_PACKAGE_htop=y
# CONFIG_PACKAGE_nano=y
# CONFIG_PACKAGE_tcpdump=y

# ===== 注释掉可能有问题的包 =====
# CONFIG_PACKAGE_docker-compose=y      # 可能增加编译复杂度
# CONFIG_PACKAGE_luci-app-aria2=y      # 非必须
# CONFIG_PACKAGE_luci-app-samba4=y     # 非必须

# ===== 确保不包含有问题的包 =====
# CONFIG_PACKAGE_grub2-efi is not set
# CONFIG_PACKAGE_kmod-amazon-ena is not set
